<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apontamento de Servi√ßo</title>
    <link rel="stylesheet" href="style.css">
    <!-- Adicionando as bibliotecas do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
    <script src="script.js" defer></script>
</head>
<body>
    <!-- Conte√∫do principal da p√°gina -->
    <div class="container">
        <h1>Apontamento de Servi√ßo</h1>
        <label for="numeroSolicitacao">N√∫mero de Solicita√ß√£o:</label>
        <input type="text" id="numeroSolicitacao">
        <button onclick="buscarSolicitacao()" aria-label="Buscar Solicita√ß√£o">Buscar</button>
        <div id="resultado"></div>

        <!-- Formul√°rio de Apontamento -->
        <div id="formApontamento" style="display: none;">
            <h3>Apontamento de Servi√ßo</h3>
            <label>Data e Hora Inicial:</label>
            <input type="datetime-local" id="dataHoraInicial">
            <label>Data e Hora Final:</label>
            <input type="datetime-local" id="dataHoraFinal">
            <label>Identifica√ß√£o do Manutentor:</label>
            <input type="text" id="manutentor">
            <label>Centro de Trabalho:</label>
            <select id="centroTrabalho">
                <option value="Eletrica">El√©trica</option>
                <option value="Mecanica">Mec√¢nica</option>
            </select>
            <label>Ordem Conclu√≠da:</label>
            <select id="ordemConcluida">
                <option value="Sim">Sim</option>
                <option value="N√£o">N√£o</option>
            </select>
            <label>Observa√ß√£o:</label>
            <textarea id="observacao"></textarea>
            <label>Anexar Imagem:</label>
            <input type="file" id="imagem" accept="image/*">
            <div id="imagemLink" style="display: none;">
                <a id="imagemLinkText" href="#" target="_blank">Clique para visualizar a imagem anexada</a>
            </div>
            <button onclick="enviarApontamento()">Enviar Apontamento</button>
        </div>
    </div>

    <!-- Rodap√© fixo com design profissional -->
    <footer>
        <div class="footer-content">
            <h3>Fale com a Holambra</h3>
            <p><strong>üìû Telefone:</strong> 14 3769-9500</p>
            <p><strong>üìß E-mail:</strong> <a href="mailto:Holambra@Holambra.com.br">Holambra@Holambra.com.br</a></p>
            <p><strong>üìç Localiza√ß√£o:</strong> COOPERATIVA AGROINDUSTRIAL Unidade Matriz</p>
            <p>Rod. Raposo Tavares, km 256 - Holambra II, Paranapanema - SP, 18725-000</p>
        </div>
    </footer>

    <script>
        // Configura√ß√£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAUlxHPDSkSDoiXA4eg5BUW9sRxZfz9GI8",
            authDomain: "apontamento-pcm-2fb0e.firebaseapp.com",
            projectId: "apontamento-pcm-2fb0e",
            storageBucket: "apontamento-pcm-2fb0e.firebasestorage.app",
            messagingSenderId: "359651627373",
            appId: "1:359651627373:web:b7e8e633348c83b5ee0a64"
        };
        
        // Inicialize o Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        async function enviarApontamento() {
            const agora = new Date();
            const camposObrigatorios = [
                { id: "dataHoraInicial", mensagem: "Preencha a Data e Hora Inicial." },
                { id: "dataHoraFinal", mensagem: "Preencha a Data e Hora Final." },
                { id: "manutentor", mensagem: "Preencha a Identifica√ß√£o do Manutentor." },
                { id: "centroTrabalho", mensagem: "Selecione o Centro de Trabalho." },
                { id: "ordemConcluida", mensagem: "Selecione se a Ordem foi Conclu√≠da." }
            ];

            let campoInvalido = false;

            camposObrigatorios.forEach(campo => {
                const elemento = document.getElementById(campo.id);
                elemento.style.border = "1px solid #ccc"; // Resetando a borda

                if (!elemento.value.trim()) {
                    alert(`‚ö†Ô∏è ${campo.mensagem}`);
                    elemento.style.border = "2px solid red"; // Destaca o erro
                    elemento.focus();
                    campoInvalido = true;
                    return;
                }
            });

            if (campoInvalido) return;

            const dataHoraFinal = new Date(document.getElementById("dataHoraFinal").value);
            if (dataHoraFinal > agora) {
                alert("‚ö†Ô∏è A Data e Hora Final n√£o pode ser maior que o momento atual.");
                document.getElementById("dataHoraFinal").style.border = "2px solid red";
                document.getElementById("dataHoraFinal").focus();
                return;
            }

            // Captura os dados do formul√°rio
            const apontamento = {
                numeroSolicitacao: document.getElementById("numeroSolicitacao").value,
                dataHoraInicial: document.getElementById("dataHoraInicial").value,
                dataHoraFinal: document.getElementById("dataHoraFinal").value,
                manutentor: document.getElementById("manutentor").value,
                centroTrabalho: document.getElementById("centroTrabalho").value,
                ordemConcluida: document.getElementById("ordemConcluida").value,
                observacao: document.getElementById("observacao").value
            };

            // Verifica se h√° imagem anexada
            const imagemInput = document.getElementById("imagem");
            if (imagemInput.files.length > 0) {
                const imagem = imagemInput.files[0];
                const formData = new FormData();
                formData.append("file", imagem);

                try {
                    const uploadResponse = await fetch("https://api.imgbb.com/1/upload?key=SUA_CHAVE_IMGBB", {
                        method: "POST",
                        body: formData
                    });

                    const uploadResult = await uploadResponse.json();
                    if (uploadResult.success) {
                        apontamento.imagemLink = uploadResult.data.url;
                    } else {
                        apontamento.imagemLink = "Erro no upload";
                    }
                } catch (error) {
                    console.error("Erro no upload da imagem:", error);
                    apontamento.imagemLink = "Erro no upload";
                }
            }

            try {
                // Salvar no Firestore
                await db.collection("apontamentos").add(apontamento);

                alert("‚úÖ Apontamento enviado com sucesso!");
                document.getElementById("formApontamento").reset();
            } catch (error) {
                console.error("Erro ao enviar apontamento:", error);
                alert("‚ùå Erro ao enviar os dados.");
            }
        }
    </script>
</body>
</html>
